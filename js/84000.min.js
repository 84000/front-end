$.noConflict(),jQuery(document).ready(function(e){function t(){if(window.location.hash&&"/"==window.location.pathname){var e=window.location.hash.split("/"),t=e[0].replace("#",""),o=t.split("-"),n="";n="section"==o[0]&&2==o.length?"/section/"+o[1]+".html":"translatedTextList"==o[0]?"/section/all-translated.html":"/translation/"+t+".html",2==e.length&&"title"!=e[1]&&(n+="#"+e[1]),n&&(location.href=n)}return!1}!function(e){e.wait=function(t,o){var n=self==top?e("body"):window.parent.$("body");if(o)e("#wait").fadeOut(500,function(){e(this).remove(),n.removeClass("wait")});else if(n.hasClass("wait"))e("#wait").text(t);else{var a=e("<span>",{id:"wait"}).text(t),i=e(window);n.addClass("wait"),n.append(a),a.css({top:(i.height()-a.outerHeight())/2+"px",left:(i.width()-a.outerWidth())/2+"px"})}}}(e),e.ajaxSetup({cache:!0}),function(e){e.mediaSize=function(){for(var t="lg",o=["xs","sm","md","lg"],n=o.length-1;n>=0;n--)if(e("#media_test .visible-"+o[n]+":visible").length){t=o[n];break}for(var a="screen",i=["print"],n=i.length-1;n>=0;n--)if(e("#media_test .visible-"+i[n]+":visible").length){a=i[n];break}for(var s="desktop",r=["mobile","desktop"],n=r.length-1;n>=0;n--)if(e("#media_test .visible-"+r[n]+":visible").length){s=r[n];break}var l=e("#media_test .event-hover:visible").length?"hover":"";e("html").removeClass(o.join(" ")).removeClass(i.join(" ")).removeClass(r.join(" ")).removeClass("hover").addClass(t).addClass(a).addClass(s).addClass(l)}}(e),e.mediaSize(),function(e){e.fn.elementInView=function(){var t=e(window),o=t.scrollTop(),n=o+t.height();if(!this.offset())return"missing";var a=this.offset().top,i=a+this.height(),s="inView";return a>o&&a<n?s="topInView":i<=o?s="above":a>=n&&(s="below"),s}}(e),function(e){e.matchHeights=function(t){if(e("html").hasClass("screen")&&(e("html").hasClass("md")||e("html").hasClass("lg")||e("html").hasClass("sm"))){var o={};e("[data-match-height]").height("auto"),e("[data-match-height].match-this-height:visible").each(function(){var t=e(this);o[t.data("match-height")]=t.outerHeight()}),t.find("[data-match-height]:not(.match-this-height):visible").each(function(){var t=e(this),n=t.outerHeight(),a=t.data("match-height");(!o[a]||n>o[a])&&(o[a]=n)}),e.each(o,function(t,o){e("[data-match-height='"+t+"']").height(o+"px")})}}}(e),function(e){e.renderInViewport=function(){e(".screen section > .render-in-viewport").each(function(){var t=e(this),o=t.siblings(".unrendered-preview");if(o.length){var n=o.elementInView();if("topInView"==n)t.render();else if("below"==n)return!1}})}}(e),function(e){e.fn.render=function(){var t=e(this);t.hasClass("render-in-viewport")&&(t.removeClass("render-in-viewport"),t.siblings(".unrendered-preview").remove(),e.matchHeights(t))}}(e),e(".screen section > .render-in-viewport:hidden").each(function(){var t=e(this),o=t.parent();if(o.length){var n,a=e("<div>",{class:"unrendered-preview"});o.hasClass("text")?n=t.find("h4, h5, p, div.list, div.line-group, blockquote, br").slice(0,5).clone():"abbreviations"==o.attr("id")?n=t.find("h5, table").clone():"notes"==o.attr("id")?n=t.find("div.footnote").slice(0,5).clone():"glossary"==o.attr("id")&&(n=t.find("div.glossary-item").slice(0,5).clone()),a.html(n),a.find(".glossarize, .glossarize-complete, .glossary-item").each(function(){e(this).addClass("ignore")}),o.append(a),a.height()>300&&a.height("300px")}}),function(e){e.scrollToAnchor=function(o,n,a,i){if(!t()&&(o||(o=window.location.hash),o)){n||(n=0),a||(a="html, body");var s=e(o),r=s.closest(".render-in-viewport");r.length&&r.render(),!i&&s&&(i=s.offset()),i&&e(a).delay(n).animate({scrollTop:i.top-30},"slow")}}}(e),e.fn.scrollEnd=function(e,t){var o=this;o.scroll(function(){o.data("scrollTimeout")&&clearTimeout(o.data("scrollTimeout")),o.data("scrollTimeout",setTimeout(e,t))})},e.fn.pulse=function(){var e=this;setTimeout(function(){e.addClass("pulse"),setTimeout(function(){e.removeClass("pulse")},750)},100)};var o=new Array;e(document).on("click","a.scroll-to-anchor",function(){if(window.location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&window.location.hostname==this.hostname){var t=e(this);if(t.not(".pop-up")){$target=e(this.hash);var n=e("#rewind-btn-container"),a=n.find("button");o.push(e(document).scrollTop()),n.removeClass("hidden"),a.pulse()}if(t.has("[data-mark]")){var i=t.data("mark");i=this.hash!=i?this.hash+" "+i:i;var s=e(i);s.removeClass("mark").removeClass("ease-all").addClass("mark"),setTimeout(function(){s.addClass("ease-all").removeClass("mark"),setTimeout(function(){s.removeClass("ease-all")},2e3)},3e3)}return e.scrollToAnchor(this.hash),!1}}),e.scrollToAnchor(),e(window).scroll(function(){e(document).scrollTop()>200?e("#link-to-top").addClass("in"):e(document).scrollTop()<200&&e("#link-to-top").removeClass("in")}),e(document).on("click","a[href='#top']:not(.milestone)",function(t){return e.scrollToAnchor("#top"),!1}),e(document).on("click","a[href='#']",function(e){return!1}),e(document).on("mouseover","html.hover .dropdown-toggle-container",function(t){e(this).addClass("open")}),e(document).on("mouseout","html.hover .dropdown-toggle-container.open",function(t){e(this).removeClass("open")}),function(e){e.fn.centerWithMargins=function(){return this.each(function(){var t=e(this);t.css({"margin-top":0,"margin-bottom":0,"margin-left":0,"margin-right":0,width:"",height:""});var o=t.parents(".thumbnail"),n=parseFloat(o.outerWidth()),a=parseFloat(o.outerHeight()),i=parseFloat(t.width()),s=parseFloat(t.height()),r=i/s,l=-300,c=-300;t.data("max-horizontal-crop")&&(l=-parseInt(t.data("max-horizontal-crop"))),t.data("max-vertical-crop")&&(c=-parseInt(t.data("max-vertical-crop")));var h=(n-i)/2,d=(a-s)/2;h<l&&(h=l,d=(a-(s=(i=n-2*l)/r))/2),d<c&&(d=c,h=(n-(i=(s=a-2*c)*r))/2);var f={"margin-top":d.toFixed(0)+"px","margin-bottom":d.toFixed(0)+"px","margin-left":h.toFixed(0)+"px","margin-right":h.toFixed(0)+"px",width:i.toFixed(0)+"px",height:s.toFixed(0)+"px"};t.css(f)}),this}}(e),e(".thumbnail img").on("load",function(){e(this).centerWithMargins()}),e(".thumbnail img").centerWithMargins(),e("html").hasClass("screen")&&e('[data-lightbox="slideshow"]').length&&e.when(e.getScript("/js/lightbox2-master/src/js/lightbox.js"),e.Deferred(function(t){e(t.resolve)})).done(function(){});if(e("html").hasClass("screen")&&(e.getBookmarks=function(){var e=Cookies.get("bookmarks");return e&&(e=JSON.parse(e)),e instanceof Object||(e=new Array),e},e.getDomain=function(){var e=window.location.hostname;return e.split(".").reverse()[1]+"."+e.split(".").reverse()[0]},function(e){e.fn.bookmarkData=function(){var t=window.location.href;locationSplit=t.split("#");var o=locationSplit[0],n=this.attr("href"),a=e("#title h1").text(),i=this.parents("section, aside").find("h3, h4").first().text(),s=this.text();return{page:o,hash:n,title:a+(i?" / "+i:"")+(s?" / "+s:"")}}}(e),function(e){e.bookmark=function(t){for(var o=e.getBookmarks(),n=!1,a=0;a<o.length;a++)o[a].page==t.page&&o[a].hash==t.hash&&(n=!0);n||o.push(t),Cookies.set("bookmarks",JSON.stringify(o),{expires:365,domain:e.getDomain()}),e.loadBookmarks(),e("#bookmarks-btn-container .badge-notification").pulse()}}(e),function(e){e.loadBookmarks=function(){var t=window.location.href;locationSplit=t.split("#");var o=locationSplit[0],n=e.getBookmarks(),a=e("table#bookmarks-list tbody"),i=e("table#bookmarks-list tfoot");if(a.empty(),i.empty(),n.length){for(var s=0;s<n.length;s++){var r=n[s].page+n[s].hash,l=n[s].page==o?"scroll-to-anchor":"",c=e("<a>",{href:r,class:l}).text(n[s].title),h=e("<a>",{href:r,class:"remove-bookmark",title:"Remove this bookmark"}).html('<i class="fa fa-minus-circle"></i>'),d=e("<tr>"),f=e("<td>"),p=e("<td>");f.append(c),p.append(h),d.append(f),d.append(p),a.append(d)}u=e("<tr>").append(e("<td>",{colspan:"2"}).text("Please note that bookmarks are stored as Cookies. Clearing cookies for this site will delete your bookmarks."));i.append(u)}else{var u=e("<tr>").append(e("<td>",{colspan:"2"}).text("You don't have any bookmarks yet. Select milestones on the left of the text to bookmark that passage."));i.append(u)}e("#bookmarks-btn .badge").text(n.length)}}(e),e.loadBookmarks(),e(document).on("click","a.milestone",function(t){t.preventDefault();var o=e(this).bookmarkData();e.bookmark(o)}),e(document).on("click","a.remove-bookmark",function(t){t.preventDefault(),t.stopPropagation();for(var o=e(this).attr("href"),n=e.getBookmarks(),a=0;a<n.length;a++)n[a].page+n[a].hash==o&&n.splice(a,1);Cookies.set("bookmarks",JSON.stringify(n),{expires:365,domain:e.getDomain()}),e.loadBookmarks()}),function(e){e.saveCurrentLocation=function(){e(".translation a.milestone").each(function(t){0==t&&Cookies.remove("lastLocation",{domain:e.getDomain()});var o=e(this);if("topInView"==o.elementInView())return Cookies.set("lastLocation",JSON.stringify(o.bookmarkData()),{expires:31,domain:e.getDomain()}),!1})}}(e),function(e){e.lastLocationOption=function(){var t=Cookies.get("lastLocation");if(t&&(t=JSON.parse(t)).page){for(var o=e.getBookmarks(),n=!1,a=o.length-1;a>=0;a--)if(o[a].page==t.page&&o[a].hash==t.hash){n=!0;break}n||["inView","topInView"].indexOf(e(t.hash).elementInView())<0&&($alert=e("#page-alert"),$alert.find(".container").append(e("<small>").text("You were reading:")).append(e("<br>")).append(t.title).append(e("<br>")).append(e("<a>",{href:t.page+t.hash,class:"scroll-to-anchor small"}).text("go there").on("click",function(t){e(this).parents("#page-alert").collapse("hide")})).append(" &bull; ").append(e("<a>",{href:t.page+t.hash,class:"small"}).text("bookmark it").on("click",function(o){o.preventDefault(),e.bookmark(t),e(this).parents("#page-alert").collapse("hide")})).append(" &bull; ").append(e("<a>",{href:t.page+t.hash,class:"small"}).text("forget it").on("click",function(t){t.preventDefault(),e(this).parents("#page-alert").collapse("hide")})),Cookies.remove("lastLocation",{domain:e.getDomain()}),$alert.collapse("show"))}}}(e),e("#page-alert").length&&e.lastLocationOption()),e(document).on("click",".collapse .close",function(t){t.preventDefault(),e(this).parents(".collapse").collapse("hide")}),function(e){e.popupFooterHeight=function(){e("#popup-footer .fix-height").css({"max-height":.5*e(window).height()+"px"})}}(e),e.popupFooterHeight(),e(".panel.main-panel > .panel-img-header+.panel-body blockquote:first-child").each(function(){if(!e("html.xs").length){var t=e(this);t.css({top:-t.outerHeight()})}}),e(document).on("click","a.pop-up",function(t){t.preventDefault();var o=e(this);e("#popup-footer").removeClass("in");var n=function(){o.trigger("prepare");var t=e(o.attr("href"));t.hasClass("glossarize")&&g(t),t.find(".glossarize, .glossarize-complete").each(function(){g(e(this))});var n=t.clone();n.attr("id",""),e("#popup-footer .data-container").html(n),e("#popup-footer").collapse("show")};o.hasClass("glossary-link")?(e.wait("Loading the glossary..."),setTimeout(function(){n(),e.wait("",!0)},100)):n()}),e(document).on("click","a.show-sidebar",function(t){t.preventDefault();var o=e(this).attr("href"),n=e(o);if(e(".fixed-footer, .fixed-sidebar").not(o).collapse("hide"),"#contents-sidebar"==o&&!n.hasClass("loaded")){var a=e("#contents > table");n.find(".data-container").html(a.clone()),n.addClass("loaded")}e(".lg "+o+" .container").width(.35*e(window).width()-40),e(".md "+o+" .container").width(.6*e(window).width()-40),e(".sm "+o+" .container").width(.75*e(window).width()-40),e(".xs "+o+" .container").width(e(window).width()-40),n.collapse("toggle")}),e(document).on("click",".fixed-sidebar a:not(.remove-bookmark)",function(t){e(this).parents(".fixed-sidebar ").collapse("hide")}),e("html").hasClass("screen")&&e("#glossary .glossary-item").length){e.expr[":"].contains=e.expr.createPseudo(function(t){return function(o){return e(o).text().toUpperCase().indexOf(t.toUpperCase())>=0}});var n,a=!1,i=e("#glossary .glossary-item:not(.ignore)"),s=e(".glossarize-section .glossarize:not(.ignore), .glossarize-section .glossarize-complete:not(.ignore)"),r=function(e){return e.split(" ").length},l=i.slice().sort(function(t,o){return+r(e(o).find(".term").text())-+r(e(t).find(".term").text())}),c=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},h=function(t,o,n){t.each(function(){var t=e(this);t.find(".term").each(function(){"marked"==t.data("match")?f(e(this),t,o):p(e(this),t,o)})}),n&&n(arguments[3],arguments[4])},d=function(e){return new RegExp("(^|\\s|‘|'|“|:|;|\"|\\(|\\[|>)("+c(e.toLowerCase())+")($|\\s|\\.|,|:|;|\\!|\\?|—|’\\W|'\\W|”|\"|\\)|\\]|<|s\\W|s<|es\\W|es<|’s\\W|’s<|'s\\W|'s<|s’\\W|s’<|s'\\W|s'<)","gi")},f=function(t,o,n){var a=o.attr("id");d(t.text());n.find("span.term:contains("+t.text()+")").each(function(t){var o=e(this),n=t>0?"mute":"";o.replaceWith('<a href="#'+a+'" class="glossary-link '+n+' pop-up">'+o.text()+"</a>")})},p=function(t,o,n){var a=t.text(),i=o.attr("id");n.each(function(){var t=e(this);if(t.hasClass("glossarize")){o=d(a);t.replaceText(o,'$1<a href="#'+i+'" class="glossary-link pop-up">$2</a>$3')}else if(t.hasClass("glossarize-complete")){var o=new RegExp("^("+c(a)+")$","gi");t.replaceText(o,'<a href="#'+i+'" class="glossary-link pop-up">$1</a>')}})},u=function(t,o){t.filter(":not(.backlinked)").each(function(){var t=e(this),o=t.attr("id"),n=e("<ul>",{class:"list-inline"});s.has("a[href='#"+o+"']").each(function(t){var a=e(this),i=a.attr("id");if(i||(i=a.parents("[id]").attr("id")),!n.find("a[href='#"+i+"']").length){var s=e("<a>",{href:"#"+i,class:"scroll-to-anchor","data-mark":"a[href='#"+o+"']"}).text(n.find("li").length+1),r=e("<li>");r.append(s),n.append(r)}});var a=n.find("li").length,i=1==a?"1 passage contains this term":a+" passages contain this term";t.find(".occurences h6").text(i),t.find(".occurences").append(n)}),o&&o()},m=function(t){var o=t.find(".term").text(),n=r(o),i=d(o);l.filter(":not(.backlinked)").filter(function(){var t=e(this).find(".term").text();return r(t)>n&&t.match(i)}).each(function(){var t=e(this);h(t,s.filter(":not(.glossarized)"),u,t,function(){a=!1,t.addClass("backlinked")})})},g=function(e){a||(a=!0,h(l,e,function(){a=!1,e.addClass("glossarized")}))},v=function(e){a||(a=!0,m(e),h(e,s.filter(":not(.glossarized)"),u,e,function(){a=!1,e.addClass("backlinked")}))};!function(e){e.showGlossaryLinks=function(){var t=e(".translation");t.removeClass("mute-glossary"),clearTimeout(n),n=setTimeout(function(){t.addClass("mute-glossary")},1e3)}}(e),function(e){e.glossarizeVisibleParagraphs=function(){if(a)return!1;s.filter(":not(.glossarized)").each(function(){var t=e(this),o=t.elementInView();if(e.showGlossaryLinks(),["inView","topInView"].indexOf(o)>=0)g(t);else if("below"==o)return!1})}}(e),function(e){e.backlinkVisibleGlossaries=function(){if(a)return!1;i.filter(":not(.backlinked)").each(function(){var t=e(this),o=t.elementInView();if(["inView","topInView"].indexOf(o)>=0)v(t);else if("below"==o)return!1})}}(e),e(document).on("prepare","a.glossary-link",function(t){v(e(e(this).attr("href")))})}e(window).scrollEnd(function(){e.renderInViewport(),"function"==typeof e.backlinkVisibleGlossaries&&e.backlinkVisibleGlossaries(),"function"==typeof e.glossarizeVisibleParagraphs&&e.glossarizeVisibleParagraphs()},700),e(window).scroll(),e(window).on("beforeunload",function(){"function"==typeof e.saveCurrentLocation&&e.saveCurrentLocation()}),e(document).on("click","[data-ajax-target]",function(t){t.preventDefault();var o=e(this),n=o.attr("href"),a=o.data("ajax-target"),i=e(a);i.is(".loaded")?i.collapse("toggle"):e.get(n,function(e){i.html(e).collapse("show").addClass("loaded")})}),e(document).on("click","a.print-href",function(t){t.preventDefault();var o=e(this).attr("href"),n=e("#print-iframe");n.length||(n=e("<iframe id='print-iframe' style='position:absolute;width:100%;height:100px;left:0px;top:-100px;z-index:-1;'>")),n.attr("src",o).appendTo("body").on("load",function(){var e=document.getElementById("print-iframe");(e.contentWindow?e.contentWindow:e.contentDocument.defaultView).print()})}),e(document).on("change",".filter-form input, .filter-form select",function(t){e(this).parents("form").submit()}),e('a[data-toggle="tab"]').on("shown.bs.tab",function(t){e.matchHeights(e(document))}),e(".alert.alert-temporary").delay(2e3).slideUp(400),e("a.log-click").on("click",function(t){"function"==typeof ga&&ga("send","pageview",e(this).attr("href"))}),e(".client-error").each(function(t){e.ajax({url:"/log-error.html",method:"POST",data:{url:window.location.href}})}),e("a.redirect-onload").each(function(t){location.href=e(this).attr("href")}),e("#rewind-btn-container button").on("click",function(t){var n=e(this);if(o.length){var a=o.pop();e("html, body").animate({scrollTop:a},"slow"),o.length||n.parents("#rewind-btn-container").addClass("hidden")}}),e("a.internal-ref").each(function(t){var o=e(this),n=o.text();if(!n){var a=e(o.attr("href"));a.hasClass("milestone")?n=a.text():a.hasClass("footnote")?n=a.find(".footnote-number").text():a.find(".milestone").length&&(n=a.find(".milestone").first().text()),o.text(n)}}),e(document).on("click","body",function(t){e(".fixed-footer, .fixed-sidebar").collapse("hide"),"function"==typeof e.showGlossaryLinks&&e.showGlossaryLinks()}),e(document).on("click",".fixed-footer, .fixed-footer a, .fixed-sidebar, .fixed-sidebar a",function(e){e.stopPropagation()}),e(window).on("resize",function(){e.mediaSize(),e.matchHeights(e(document)),e.popupFooterHeight()}),e(window).resize()});